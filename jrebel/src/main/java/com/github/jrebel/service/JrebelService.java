//package com.github.jrebel.service;
//
//import com.github.jrebel.core.util.JrebelUtil.JrebelSign;
//import com.github.jrebel.core.util.JsonUtil;
//import lombok.SneakyThrows;
//import org.springframework.stereotype.Service;
//
//import javax.servlet.http.HttpServletRequest;
//import javax.servlet.http.HttpServletResponse;
//import java.util.Map;
//
//public class JrebelService {
//
//
//    @SneakyThrows
//    public void jrebelLeasesHandler(HttpServletRequest request, HttpServletResponse response) {
//        response.setContentType("application/json; charset=utf-8");
//        response.setStatus(HttpServletResponse.SC_OK);
//        String clientRandomness = request.getParameter("randomness");
//        String username = request.getParameter("username");
//        String guid = request.getParameter("guid");
//        boolean offline = Boolean.parseBoolean(request.getParameter("offline"));
//        String validFrom = "null";
//        String validUntil = "null";
//        if (offline) {
//            String clientTime = request.getParameter("clientTime");
//            String offlineDays = request.getParameter("offlineDays");
//            //long clinetTimeUntil = Long.parseLong(clientTime) + Long.parseLong(offlineDays)  * 24 * 60 * 60 * 1000;
//            long clinetTimeUntil = Long.parseLong(clientTime) + 180L * 24 * 60 * 60 * 1000;
//            validFrom = clientTime;
//            validUntil = String.valueOf(clinetTimeUntil);
//        }
//        String jsonStr = "{\n" +
//                "    \"serverVersion\": \"3.2.4\",\n" +
//                "    \"serverProtocolVersion\": \"1.1\",\n" +
//                "    \"serverGuid\": \"a1b4aea8-b031-4302-b602-670a990272cb\",\n" +
//                "    \"groupType\": \"managed\",\n" +
//                "    \"id\": 1,\n" +
//                "    \"licenseType\": 1,\n" +
//                "    \"evaluationLicense\": false,\n" +
//                "    \"signature\": \"OJE9wGg2xncSb+VgnYT+9HGCFaLOk28tneMFhCbpVMKoC/Iq4LuaDKPirBjG4o394/UjCDGgTBpIrzcXNPdVxVr8PnQzpy7ZSToGO8wv/KIWZT9/ba7bDbA8/RZ4B37YkCeXhjaixpmoyz/CIZMnei4q7oWR7DYUOlOcEWDQhiY=\",\n" +
//                "    \"serverRandomness\": \"H2ulzLlh7E0=\",\n" +
//                "    \"seatPoolType\": \"standalone\",\n" +
//                "    \"statusCode\": \"SUCCESS\",\n" +
//                "    \"offline\": " + String.valueOf(offline) + ",\n" +
//                "    \"validFrom\": " + validFrom + ",\n" +
//                "    \"validUntil\": " + validUntil + ",\n" +
//                "    \"company\": \"Administrator\",\n" +
//                "    \"orderId\": \"\",\n" +
//                "    \"zeroIds\": [\n" +
//                "        \n" +
//                "    ],\n" +
//                "    \"licenseValidFrom\": 1490544001000,\n" +
//                "    \"licenseValidUntil\": 1691839999000\n" +
//                "}";
//
//        if (clientRandomness == null || username == null || guid == null) {
//            response.setStatus(HttpServletResponse.SC_FORBIDDEN);
//        } else {
//            Map map = JsonUtil.toObject(jsonStr, Map.class);
//            JrebelSign jrebelSign = new JrebelSign();
//            jrebelSign.toLeaseCreateJson(clientRandomness, guid, offline, validFrom, validUntil);
//            String signature = jrebelSign.getSignature();
//            map.put("signature", signature);
//            map.put("company", username);
//            String body = JsonUtil.toJson(map);
//            response.getWriter().print(body);
//        }
//    }
//
//
//    @SneakyThrows
//    public void jrebelValidateHandler(HttpServletRequest request, HttpServletResponse response) {
//        response.setContentType("application/json; charset=utf-8");
//        response.setStatus(HttpServletResponse.SC_OK);
//        String jsonStr = "{\n" +
//                "    \"serverVersion\": \"3.2.4\",\n" +
//                "    \"serverProtocolVersion\": \"1.1\",\n" +
//                "    \"serverGuid\": \"a1b4aea8-b031-4302-b602-670a990272cb\",\n" +
//                "    \"groupType\": \"managed\",\n" +
//                "    \"statusCode\": \"SUCCESS\",\n" +
//                "    \"company\": \"Administrator\",\n" +
//                "    \"canGetLease\": true,\n" +
//                "    \"licenseType\": 1,\n" +
//                "    \"evaluationLicense\": false,\n" +
//                "    \"seatPoolType\": \"standalone\"\n" +
//                "}\n";
//        response.getWriter().print(JsonUtil.toJson(JsonUtil.toObject(jsonStr, Object.class)));
//    }
//
//    @SneakyThrows
//    public void jrebelLeases1Handler(HttpServletRequest request, HttpServletResponse response) {
//        response.setContentType("application/json; charset=utf-8");
//        response.setStatus(HttpServletResponse.SC_OK);
//        String username = request.getParameter("username");
//        String jsonStr = "{\n" +
//                "    \"serverVersion\": \"3.2.4\",\n" +
//                "    \"serverProtocolVersion\": \"1.1\",\n" +
//                "    \"serverGuid\": \"a1b4aea8-b031-4302-b602-670a990272cb\",\n" +
//                "    \"groupType\": \"managed\",\n" +
//                "    \"statusCode\": \"SUCCESS\",\n" +
//                "    \"msg\": null,\n" +
//                "    \"statusMessage\": null\n" +
//                "}\n";
//        Map map = JsonUtil.toObject(jsonStr, Map.class);
//        if (username != null) {
//            map.put("company", username);
//        }
//        String body = JsonUtil.toJson(map);
//        response.getWriter().print(body);
//
//    }
//
//
//}
